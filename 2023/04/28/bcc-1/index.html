<!-- build time:Thu May 04 2023 14:26:07 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="风雪追击" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="风雪追击" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="风雪追击" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Ebpf,BCC"><link rel="canonical" href="http://example.com/2023/04/28/bcc-1/"><title>【内核追踪】Centos7，BCC安装使用 - Ebpf内核追踪 | Legend Provence = 风雪追击 = 一缕春风走向你</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">【内核追踪】Centos7，BCC安装使用</h1><div class="meta"><span class="item" title="作成日：2023-04-28 13:51:48"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">投稿日</span> <time itemprop="dateCreated datePublished" datetime="2023-04-28T13:51:48+08:00">2023-04-28</time> </span><span class="item" title="単語数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">単語数</span> <span>5.3k</span> <span class="text">単語</span> </span><span class="item" title="読書の時間"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">読書の時間</span> <span>5 分</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="ナビゲーションバーの切り替え"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Legend Provence</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://pic2.imgdb.cn/item/6447e8b70d2dde5777754968.jpg"></li><li class="item" data-background-image="https://pic2.imgdb.cn/item/6447e8480d2dde5777747c1a.jpg"></li><li class="item" data-background-image="https://pic2.imgdb.cn/item/6447e8b70d2dde5777754911.jpg"></li><li class="item" data-background-image="https://pic2.imgdb.cn/item/6447e8e80d2dde577775a2e6.jpg"></li><li class="item" data-background-image="https://pic2.imgdb.cn/item/6447e8970d2dde5777750dcb.jpg"></li><li class="item" data-background-image="https://pic2.imgdb.cn/item/6447e8470d2dde5777747b92.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">ホーム</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Ebpf%E5%86%85%E6%A0%B8%E8%BF%BD%E8%B8%AA/" itemprop="item" rel="index" title="カテゴリ Ebpf内核追踪"><span itemprop="name">Ebpf内核追踪</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn"><link itemprop="mainEntityOfPage" href="http://example.com/2023/04/28/bcc-1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="风雪追击"><meta itemprop="description" content="一缕春风走向你, 记录博客，从事驱动开发，unity业余爱好"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="风雪追击"></span><div class="body md" itemprop="articleBody"><h2 id="1内核升级"><a class="anchor" href="#1内核升级">#</a> 1. 内核升级</h2><p>BCC 使用需要内核版本大于 4.1，我的环境是 centos7.9，内核版本是 3.10，因此需要首先进行内核升级。</p><h3 id="11更新yum源仓库"><a class="anchor" href="#11更新yum源仓库">#</a> 1.1 更新 yum 源仓库</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ yum <span class="token parameter variable">-y</span> update</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$rpm</span> <span class="token parameter variable">--import</span> https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$rpm</span> <span class="token parameter variable">-Uvh</span> http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</pre></td></tr></table></figure><p>查看可用内核包</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$yum</span> <span class="token parameter variable">--disablerepo</span><span class="token operator">=</span><span class="token string">"*"</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span><span class="token string">"elrepo-kernel"</span> list available</pre></td></tr></table></figure><h3 id="12安装新内核"><a class="anchor" href="#12安装新内核">#</a> 1.2 安装新内核</h3><p>查看旧内核相关项</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span><span class="token function">grep</span> kernel</pre></td></tr></table></figure><p>先卸载旧的 kernel-headers，kernel-tools, kernel-tools-libs，只保留内核。<br>之后安装新内核及相关库</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$yum</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span>elrepo-kernel <span class="token function">install</span> kernel-ml</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$yum</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span>elrepo-kernel <span class="token function">install</span>  kernel-ml-headers kernel-ml-tools kernel-ml-tools-libs kernel-ml-devel</pre></td></tr></table></figure><p>设置启动项</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">## 生成启动项配置文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$grub2</span>-mkconfig  <span class="token parameter variable">-o</span> /boot/grub2/grub.cfg</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#查看当前设置</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$grub2</span>-editenv list</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">saved_entry</span><span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token variable">$grub2</span>-set-default <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">## 重启</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token variable">$reboot</span></pre></td></tr></table></figure><p><code>重启可能会报错，此时进入设备bios，关闭安全模式再次尝试</code></p><h3 id="13安装网卡驱动"><a class="anchor" href="#13安装网卡驱动">#</a> 1.3 安装网卡驱动</h3><p>重启进入新内核后可能存在网络不通，网卡不识别情况，应该是网卡驱动与内核版本不匹配，需要去官网下载网卡驱动并安装。<br>首先查看网卡驱动版本</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$lspci</span> <span class="token parameter variable">-v</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        Subsystem: Dell Device 09a8</pre></td></tr><tr><td data-num="3"></td><td><pre>        Flags: bus master, fast devsel, latency <span class="token number">0</span>, IRQ <span class="token number">16</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        I/O ports at <span class="token number">3000</span> <span class="token punctuation">[</span>size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        Memory at d1004000 <span class="token punctuation">(</span><span class="token number">64</span>-bit, non-prefetchable<span class="token punctuation">)</span> <span class="token punctuation">[</span>size<span class="token operator">=</span>4K<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        Memory at d1000000 <span class="token punctuation">(</span><span class="token number">64</span>-bit, non-prefetchable<span class="token punctuation">)</span> <span class="token punctuation">[</span>size<span class="token operator">=</span>16K<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> Power Management version <span class="token number">3</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> MSI: Enable- <span class="token assign-left variable">Count</span><span class="token operator">=</span><span class="token number">1</span>/1 Maskable- 64bit+</pre></td></tr><tr><td data-num="9"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">]</span> Express Endpoint, MSI 01</pre></td></tr><tr><td data-num="10"></td><td><pre>        Capabilities: <span class="token punctuation">[</span>b0<span class="token punctuation">]</span> MSI-X: Enable+ <span class="token assign-left variable">Count</span><span class="token operator">=</span><span class="token number">4</span> Masked-</pre></td></tr><tr><td data-num="11"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> Advanced Error Reporting</pre></td></tr><tr><td data-num="12"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">140</span><span class="token punctuation">]</span> Virtual Channel</pre></td></tr><tr><td data-num="13"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span> Device Serial Number 01-00-00-00-68-4c-e0-00</pre></td></tr><tr><td data-num="14"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">170</span><span class="token punctuation">]</span> Latency Tolerance Reporting</pre></td></tr><tr><td data-num="15"></td><td><pre>        Capabilities: <span class="token punctuation">[</span><span class="token number">178</span><span class="token punctuation">]</span> L1 PM Substates</pre></td></tr><tr><td data-num="16"></td><td><pre>        Kernel driver <span class="token keyword">in</span> use: r8169</pre></td></tr><tr><td data-num="17"></td><td><pre>        Kernel modules: r8169</pre></td></tr></table></figure><p>就看 Kernel modules: r8169 这一行，说明需要 r8169 这个驱动<br><span class="exturl" data-url="aHR0cHM6Ly93d3cucmVhbHRlay5jb20vemgtdHcvY29tcG9uZW50L3pvby9jYXRlZ29yeS9wY2ktODE2OS04MTEw">下载地址</span><br>下载后进入目录依次执行</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$rmmod</span> r8169</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$make</span> clean module</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$make</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$depmod</span> <span class="token parameter variable">-a</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token variable">$modprobe</span> r8169</pre></td></tr></table></figure><p>这之后网卡应该就可以正常识别了</p><h2 id="2安装bcc"><a class="anchor" href="#2安装bcc">#</a> 2 安装 BCC</h2><h3 id="21安装各种编译依赖"><a class="anchor" href="#21安装各种编译依赖">#</a> 2.1 安装各种编译依赖</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> epel-release</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> yum update <span class="token parameter variable">-y</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> yum groupinstall <span class="token parameter variable">-y</span> <span class="token string">"Development tools"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> elfutils-libelf-devel cmake3 <span class="token function">git</span> bison flex ncurses-devel</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> luajit luajit-devel  <span class="token comment"># for Lua support</span></pre></td></tr></table></figure><h3 id="安装编译llvm"><a class="anchor" href="#安装编译llvm">#</a> 安装编译 llvm</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span>  <span class="token parameter variable">-LO</span>  http://releases.llvm.org/7.0.1/llvm-7.0.1.src.tar.xz</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">curl</span>  <span class="token parameter variable">-LO</span>  http://releases.llvm.org/7.0.1/cfe-7.0.1.src.tar.xz</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">tar</span> <span class="token parameter variable">-xf</span> cfe-7.0.1.src.tar.xz</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">tar</span> <span class="token parameter variable">-xf</span> llvm-7.0.1.src.tar.xz</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">mkdir</span> clang-build</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">mkdir</span> llvm-build</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">cd</span> llvm-build</pre></td></tr><tr><td data-num="10"></td><td><pre>cmake3 <span class="token parameter variable">-G</span> <span class="token string">"Unix Makefiles"</span> <span class="token parameter variable">-DLLVM_TARGETS_TO_BUILD</span><span class="token operator">=</span><span class="token string">"BPF;X86"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release <span class="token punctuation">..</span>/llvm-7.0.1.src</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">make</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/clang-build</pre></td></tr><tr><td data-num="16"></td><td><pre>cmake3 <span class="token parameter variable">-G</span> <span class="token string">"Unix Makefiles"</span> <span class="token parameter variable">-DLLVM_TARGETS_TO_BUILD</span><span class="token operator">=</span><span class="token string">"BPF;X86"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release <span class="token punctuation">..</span>/cfe-7.0.1.src</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">make</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span></pre></td></tr></table></figure><h3 id="22编译安装bcc"><a class="anchor" href="#22编译安装bcc">#</a> 2.2 编译安装 bcc</h3><p>前面编译的 llvm 是 7.0 版本，根据官网的说明，bcc 最新版本需要 11，因此安装 0.24.0 版本，下载<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lvdmlzb3IvYmNjL3JlbGVhc2VzL3RhZy92MC4yNC4w"> release 版本</span><br>注意，要下载 <code>bcc-src-with-submodule</code> ，不然会少一下库文件。</p><p>下载好解压后执行以下命令进行安装</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">git</span> clone https://github.com/iovisor/bcc.git</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> bcc/build<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> bcc/build</pre></td></tr><tr><td data-num="3"></td><td><pre>cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DCMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/usr</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">make</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">make</span> <span class="token function">install</span></pre></td></tr></table></figure><h2 id="附录"><a class="anchor" href="#附录">#</a> 附录</h2><p>在 /usr/share/bcc/tools/ 下有一系列基于 bcc 实现的工具，如下：</p><pre><code class="language-argdist.py">bashreadline.py 获取正在运行的bash命令所带的参数
biolatency.py 统计block IO请求的耗时，打印直方图
biosnoop.py 打印每次block IO请求的详细信息
biotop.py 打印每个进程的block IO详情
bitesize.py 分别打印每个进程的IO请求直方图
bpflist.py 打印当前系统正在运行哪些BPF程序
btrfsslower.py 打印btrfs 慢于某一阈值的 read/write/open/fsync 操作的数量
cachestat.py 打印Linux页缓存 hit/miss状况
cachetop.py 分别打印每个进程的页缓存状况
capable.py 跟踪到内核函数 cap_capable() （安全检查相关）的调用，打印详情
ujobnew.sh 跟踪内存对象分配事件，打印统计，对研究GC很有帮助
cpudist.py 统计task on-CPU time，即任务在被调度走之前在CPU上执行的时间
cpuunclaimed.py 跟踪CPU run queues length，打印idle CPU (yet unclaimed by waiting threads) 百分比
criticalstat.py 跟踪涉及内核原子操作的事件，打印调用栈
dbslower.py 跟踪 MySQL 或 PostgreSQL 的慢查询
dbstat.py 打印MySQL或PostgreSQL的查询耗时直方图
dcsnoop.py 跟踪目录缓存（dcache）查询请求
dcstat.py 打印目录缓存（dcache）统计信息
deadlock.py 检查运行中的进行可能存在的死锁
execsnoop.py 跟踪新进程创建事件
ext4dist.py 跟踪ext4文件系统的 read/write/open/fsyncs 请求，打印耗时直方图
ext4slower.py 跟踪ext4慢请求
filelife.py 跟踪短寿命文件（跟踪期间创建然后删除）
fileslower.py 跟踪较慢的同步读写请求
filetop.py 打印文件读写排行榜（top），以及进程详细信息
funccount.py 跟踪指定函数的调用次数，支持正则表达式
funclatency.py 跟踪指定函数，打印耗时
funcslower.py 跟踪唤醒时间（function invocations）较慢的内核和用户函数
gethostlatency.py 跟踪hostname查询耗时
hardirqs.py 跟踪硬中断耗时
inject.py
javacalls.sh
javaflow.sh
javagc.sh
javaobjnew.sh
javastat.sh
javathreads.sh
killsnoop.py 跟踪 kill() 系统调用发出的信号
llcstat.py 跟踪缓存引用和缓存命中率事件
mdflush.py 跟踪md driver level的flush事件
memleak.py 检查内存泄漏
mountsnoop.py 跟踪mount和unmount系统调用
mysqld_qslower.py 跟踪MySQL慢查询
nfsdist.py 打印NFS read/write/open/getattr 耗时直方图
nfsslower.py 跟踪NFS read/write/open/getattr慢操作
nodegc.sh 跟踪高级语言（Java/Python/Ruby/Node/）的GC事件
offcputime.py 跟踪被阻塞的进程，打印调用栈、阻塞耗时等信息
offwaketime.py 跟踪被阻塞且off-CPU的进程
oomkill.py 跟踪Linux out-of-memory (OOM) killer
opensnoop.py 跟踪 open() 系统调用
perlcalls.sh
perlstat.sh
phpcalls.sh
phpflow.sh
phpstat.sh
pidpersec.py 跟踪每分钟新创建的进程数量（通过跟踪 fork() ）
profile.py CPU profiler
pythoncalls.sh
pythoonflow.sh
pythongc.sh
pythonstat.sh
reset-trace.sh
rubycalls.sh
rubygc.sh
rubyobjnew.sh
runqlat.py 调度器run queue latency直方图，每个task等待CPU的时间
runqlen.py 调度器run queue使用百分比
runqslower.py 跟踪调度延迟很大的进程（等待被执行但是没有空闲CPU）
shmsnoop.py 跟踪 shm*() 系统调用
slabratetop.py 跟踪内核内存分配缓存（SLAB或SLUB）
sofdsnoop.py 跟踪unix socket 文件描述符（FD）
softirqs.py 跟踪软中断
solisten.py 跟踪内核TCP listen事件
sslsniff.py 跟踪OpenSSL/GnuTLS/NSS的 write/send和read/recv函数
stackcount.py 跟踪函数和调用栈
statsnoop.py 跟踪 stat() 系统调用
syncsnoop.py 跟踪 sync() 系统调用
syscount.py 跟踪各系统调用次数
tclcalls.sh
tclflow.sh
tclobjnew.sh
tclstat.sh
tcpaccept.py 跟踪内核接受TCP连接的事件
tcpconnect.py 跟踪内核建立TCP连接的事件
tcpconnlat.py 跟踪建立TCP连接比较慢的事件，打印进程、IP、端口等详细信息
tcpdrop.py 跟踪内核drop TCP 包或片（segment）的事件
tcplife.py 打印跟踪期间建立和关闭的的TCP session
tcpretrans.py 跟踪TCP重传
tcpstates.py 跟踪TCP状态变化，包括每个状态的时长
tcpsubnet.py 根据destination打印每个subnet的throughput
tcptop.py 根据host和port打印throughput
tcptracer.py 跟踪进行TCP connection操作的内核函数
tplist.py 打印内核tracepoint和USDT probes点，已经它们的参数
trace.py 跟踪指定的函数，并按照指定的格式打印函数当时的参数值
ttysnoop.py 跟踪指定的tty或pts设备，将其打印复制一份输出
vfscount.py 统计VFS（虚拟文件系统）调用
vfsstat.py 跟踪一些重要的VFS函数，打印统计信息
wakeuptime.py 打印进程被唤醒的延迟及其调用栈
xfsdist.py 打印XFS read/write/open/fsync 耗时直方图
xfsslower.py 打印XFS慢请求
zfsdist.py 打印ZFS read/write/open/fsync 耗时直方图
zfsslower.py 打印ZFS慢请求


</code></pre><div class="tags"><a href="/tags/Ebpf/" rel="tag"><i class="ic i-tag"></i> Ebpf</a> <a href="/tags/BCC/" rel="tag"><i class="ic i-tag"></i> BCC</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">編集日</span> <time title="修正日：2023-05-04 14:21:31" itemprop="dateModified" datetime="2023-05-04T14:21:31+08:00">2023-05-04</time> </span><span id="2023/04/28/bcc-1/" class="item leancloud_visitors" data-flag-title="【内核追踪】Centos7，BCC安装使用" title="閲覧数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">閲覧数</span> <span class="leancloud-visitors-count"></span> <span class="text">回</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 寄付</button><p>*~(￣▽￣)~[お茶]を一杯ください</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="风雪追击 WeChat 支払う"><p>WeChat 支払う</p></div><div><img data-src="/images/alipay.png" alt="风雪追击 Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="风雪追击 PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>著者： </strong>风雪追击 <i class="ic i-at"><em>@</em></i>风雪追击</li><li class="link"><strong>記事へのリンク：</strong> <a href="http://example.com/2023/04/28/bcc-1/" title="【内核追踪】Centos7，BCC安装使用">http://example.com/2023/04/28/bcc-1/</a></li><li class="license"><strong>著作権表示： </strong>このブログ内のすべての記事は、特別な記載がない限り <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> の下のライセンスで保護されています。</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/04/27/kernel-trace/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;pic2.imgdb.cn&#x2F;item&#x2F;6447e8480d2dde5777747bd0.jpg" title="【内核追踪】BCC，bpftrace，libbpf内核追踪技术初探及对比"><span class="type">前の記事</span> <span class="category"><i class="ic i-flag"></i> Ebpf内核追踪</span><h3>【内核追踪】BCC，bpftrace，libbpf内核追踪技术初探及对比</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="見出し"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E5%86%85%E6%A0%B8%E5%8D%87%E7%BA%A7"><span class="toc-number">1.</span> <span class="toc-text">1. 内核升级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E6%9B%B4%E6%96%B0yum%E6%BA%90%E4%BB%93%E5%BA%93"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 更新 yum 源仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E5%AE%89%E8%A3%85%E6%96%B0%E5%86%85%E6%A0%B8"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 安装新内核</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E5%AE%89%E8%A3%85%E7%BD%91%E5%8D%A1%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 安装网卡驱动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E5%AE%89%E8%A3%85bcc"><span class="toc-number">2.</span> <span class="toc-text">2 安装 BCC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21%E5%AE%89%E8%A3%85%E5%90%84%E7%A7%8D%E7%BC%96%E8%AF%91%E4%BE%9D%E8%B5%96"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 安装各种编译依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91llvm"><span class="toc-number">2.2.</span> <span class="toc-text">安装编译 llvm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85bcc"><span class="toc-number">2.3.</span> <span class="toc-text">2.2 编译安装 bcc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">3.</span> <span class="toc-text">附录</span></a></li></ol></div><div class="related panel pjax" data-title="関連記事"><ul><li><a href="/2023/04/27/kernel-trace/" rel="bookmark" title="【内核追踪】BCC，bpftrace，libbpf内核追踪技术初探及对比">【内核追踪】BCC，bpftrace，libbpf内核追踪技术初探及对比</a></li><li class="active"><a href="/2023/04/28/bcc-1/" rel="bookmark" title="【内核追踪】Centos7，BCC安装使用">【内核追踪】Centos7，BCC安装使用</a></li></ul></div><div class="overview panel" data-title="概要"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="风雪追击" data-src="/images/avatar.jpg"><p class="name" itemprop="name">风雪追击</p><div class="description" itemprop="description">记录博客，从事驱动开发，unity业余爱好</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">4</span> <span class="name">ポスト</span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span> <span class="name">カテゴリ</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">タグ</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Byb3ZlbmNlOTY1NDM3P3RhYj1yZXBvc2l0b3JpZXM=" title="https:&#x2F;&#x2F;github.com&#x2F;Provence965437?tab&#x3D;repositories"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>ホーム</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>プロフィール</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>投稿</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>アーカイブ</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>カテゴリ</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>タグ</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>ランダムな記事</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/dpdk%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB/" title="カテゴリ dpdk代码解读">dpdk代码解读</a></div><span><a href="/2023/04/25/dpdk-log/" title="log代码解读">log代码解读</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%A7%86%E9%A2%91%E7%BD%91%E7%AB%99/" title="カテゴリ 视频网站">视频网站</a></div><span><a href="/2023/04/26/video_web-1/" title="【uniapp+express+mysql制作视频网站】express后端搭建">【uniapp+express+mysql制作视频网站】express后端搭建</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Ebpf%E5%86%85%E6%A0%B8%E8%BF%BD%E8%B8%AA/" title="カテゴリ Ebpf内核追踪">Ebpf内核追踪</a></div><span><a href="/2023/04/27/kernel-trace/" title="【内核追踪】BCC，bpftrace，libbpf内核追踪技术初探及对比">【内核追踪】BCC，bpftrace，libbpf内核追踪技术初探及对比</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Ebpf%E5%86%85%E6%A0%B8%E8%BF%BD%E8%B8%AA/" title="カテゴリ Ebpf内核追踪">Ebpf内核追踪</a></div><span><a href="/2023/04/28/bcc-1/" title="【内核追踪】Centos7，BCC安装使用">【内核追踪】Centos7，BCC安装使用</a></span></li></ul></div><div><h2>最近のコメント</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">风雪追击 @ Legend Provence</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="単語の総数">9k 単語</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="読書の合計時間">8 分</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/04/28/bcc-1/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"検索…",empty:"「 ${query} 」については何も見つかりませんでした",stats:"${time} ms以内に ${hits} 件の結果が見つかりました"},valine:!0,fancybox:!0,copyright:"コピーは成功しました。 <br> 再印刷については、 ％s 契約に従ってください。",ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->